# vim: set ft=yaml:

groups:
  - name: manila-maia
    rules:
      # Maia metrics: openstack_manila_share_snapmirror_snapshot_size_bytes
      # Description: Snapshot size induced by share replicas or other snapmirror relationships
      - record: netapp_volume_snapmirror_snapshot_size_bytes:maia
        expr: |
          sum (
            sum (
              netapp_snapshot_size{volume=~"share_.*", snapshot=~"snapmirror.*"}
            ) by (filer, svm, volume) *
            on (filer, svm, volume) group_left(share_id, project_id) netapp_volume_labels
          ) by (share_id, project_id)
